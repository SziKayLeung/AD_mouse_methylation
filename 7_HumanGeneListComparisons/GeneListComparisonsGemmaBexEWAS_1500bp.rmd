---
title: "Gemma Bex meta-analysis Gene Comparisons"
author: "Emma Walker"
output: 
  html_document:
    toc: true
    toc_float: true
---

Note: This is an edited version of the GeneListComparisons2.rmd script (now in 'scratch'). Changes have been made to the following:

1) only using chipseeker annotations for RRBS data (reannotated to 1500bp window)
2) array data has been re-annotated using the Array_reannotateResultsFilesTSS1500bp.r script so cpgs are only annotated to a gene if they are genic or +/-1500bp from TSS. This aligns with the RRBS chipseeker annotations (scripts 05bx.r) which also use a 1500bp window.
3) Venn diagrams for all pathology models


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(knitr)
#library(DataCombine)
library(VennDiagram)
library(RColorBrewer)
library(plyr)

setwd("/gpfs/ts0/projects/Research_Project-191406/EmmaW/HumanGeneListComparisons/")

#define unique anno function
uniqueAnno<-function(row){
if(row != ""){
	return(paste(unique(unlist(strsplit(row, "\\;"))), collapse = ";"))
	} else {
	return(row)
	}
}

source("function_makeGeneList_RRBS.r")
source("function_cbind.fill.r")

# read in gene conversion file
mouse2human <- read.csv("mousehumangeneconversion.csv")

```

# Overlap with Gemma/Bex meta-analysis results


```{r load gene list from Gemma, warning=F, message=F, echo = F, include = F}

#read in results file from meta analysis
resFile <- read.csv("/gpfs/ts0/projects/Research_Project-191406/EmmaW/HumanGeneListComparisons/DMPs_meta2021_fixed_effect.csv", stringsAsFactors = F)

## reduce gene annotation to unique genes
resFile$UCSC_REFGENE_NAME<-unlist(lapply(resFile$UCSC_REFGENE_NAME, uniqueAnno))
## exclude sites with no gene anno
resFile<-resFile[-c(which(resFile$UCSC_REFGENE_NAME == "")),]
# create list of genes
human <-unique(unlist(strsplit(resFile$UCSC_REFGENE_NAME, "\\;")))

# convert to mouse
converted <- left_join(as.data.frame(human), mouse2human)
converted <- as.character(converted$mouse[!is.na(converted$mouse)])
```

There are `r length(human)` unique genes which were annotated to significant DMPs in the 2021 meta-analysis results file. However 29 of these do not have a mouse analogue, leaving 155 for comparison.

The tables below shows how many of these genes are also annotated to a significant site in the RRBS and array data results files

### RRBS rTg4510

```{r RRBS rTg4510 DMPs, warning=F, message=F, echo = F, out.width="50%"}

#create summary table to hold information from for loop
tab <- data.frame(matrix(ncol = 5, nrow = 4))
colnames(tab) <- c("Model.Term", "N.Results", "N.Results.Overlaps","N.Genes", "N.Overlaps")
tab$Model.Term <- c("Age", "Genotype", "Interaction", "Pathology")


#load in files
temp <- list.files("/gpfs/mrc0/projects/Research_Project-MRC148213/sl693/scripts/rrbs-ad-mice/Figures/",pattern="rTg4510_rrbs",full.names = T)

overlap_list <- list()
overlap_df <- list()

#create gene lists
for(i in 1:length(temp)){
  
  # read in results file
  file <- read.csv(temp[i], stringsAsFactors = F)
  
  #Create list of RRBS chipseeker annotated genes
  ## reduce gene annotation to unique genes
  file[which(is.na(file$InGeneBodyOr1500bpTSS_SYMBOL)), "InGeneBodyOr1500bpTSS_SYMBOL"] <- "" # change NA's to ""
  RRBS_genes <- unlist(lapply(file$InGeneBodyOr1500bpTSS_SYMBOL, uniqueAnno))
  ## exclude sites with no gene anno
   if(sum(RRBS_genes == "") != 0){
    RRBS_genes <- RRBS_genes[-c(which(RRBS_genes == ""))]
  }
  # create list of genes
  RRBS_genes <-unique(unlist(strsplit(RRBS_genes, "\\;")))
  
  chipseeker_overlap <- intersect(RRBS_genes, converted)
  overlap_list[[i]] <- sort(chipseeker_overlap)
  overlap_df[[i]] <- file[file$ChIPseeker_GeneSymbol%in% chipseeker_overlap,]
  
  
  #populate table
  tab[i, "N.Results"] <- nrow(file)
  tab[i, "N.Results.Overlaps"] <- nrow(file[file$ChIPseeker_GeneSymbol %in% chipseeker_overlap,])
  tab[i, "N.Genes"] <- length(RRBS_genes)
  tab[i,"N.Overlaps"] <- paste0(length(chipseeker_overlap)," (", round(length(chipseeker_overlap)/length(RRBS_genes) * 100,2), "%)")
  
}

kable(tab, caption = "RRBS rTg4510")
names(overlap_df) <- c("genotype","interaction","pathology")


resFile[resFile$UCSC_REFGENE_NAME == "NRXN2",]
overlap_df$genotype[overlap_df$genotype$ChIPseeker_GeneSymbol == "Nrxn2",]
overlap_df$genotype[overlap_df$genotype$ChIPseeker_GeneSymbol == "Ank1",]
overlap_df$pathology[overlap_df$pathology$ChIPseeker_GeneSymbol == "Ank1",]


overlap_df$pathology[overlap_df$pathology$ChIPseeker_GeneSymbol %in% c("Hoxa4","Hoxb3"),]


View(overlap_df$pathology)
resFile[resFile$UCSC_REFGENE_NAME == "ANK1",]

overlap_df$genotype[overlap_df$genotype$ChIPseeker_GeneSymbol == "Ank1","Position"]
overlap_df$pathology[overlap_df$pathology$ChIPseeker_GeneSymbol == "Ank1","Position"]

overlapGenotype <- aggregate(meth.diff.Genotype ~ ChIPseeker_GeneSymbol, data=overlap_df$genotype, mean) %>% 
  mutate(humanGene = toupper(ChIPseeker_GeneSymbol), meth.diff.Genotype = -meth.diff.Genotype) %>% 
  merge(., resFile[resFile$UCSC_REFGENE_NAME %in% toupper(overlap_df$genotype$ChIPseeker_GeneSymbol),c("Effect_fixed","UCSC_REFGENE_NAME")] %>%
  aggregate(Effect_fixed ~ UCSC_REFGENE_NAME, data=., mean),
        by.x = "humanGene", by.y= "UCSC_REFGENE_NAME")

cor.test(overlapGenotype$meth.diff.Genotype,overlapGenotype$Effect_fixed)
```



```{r RRBS rTg4510 code vennDiagram, echo=FALSE, include=FALSE}
  
myCol <- c("azure2", "bisque1")

venn.diagram(
  x = list(converted, RRBS_genes),
  category.names = c("Meta-analysis", "Chipseeker annotated"), imagetype = "png",
  filename = "images/RRBS_rTg4510_pathology_meta.png", main = "RRBS rTg4510 Pathology", fil = myCol, cat.default.pos= "text"
  )

```

<center>

![rTg4510 Pathology](images/RRBS_rTg4510_pathology_meta.png){width=50%}

</center>



List of RRBS rTg4510 genes (annotated with chipseeker) which overlap 
with the meta-analysis gene list:

```{r RRBS rTg4510 gene list, echo=FALSE}

geneList <- makeGeneList(overlap_list)
kable(geneList)

```

<p>&nbsp;</p>

### RRBS J20

```{r RRBS J20 DMPs, warning=F, message=F, echo = F, out.width="50%"}

#create summary table to hold information from for loop
tab <- data.frame(matrix(ncol = 4, nrow = 4))
colnames(tab) <- c("Model.Term", "N.Results", "N.Genes", "N.Overlaps")
tab$Model.Term <- c("Age", "Genotype", "Interaction", "Pathology")

#load in files
temp <- list.files("/gpfs/ts0/projects/Research_Project-191406/EmmaW/RRBSAnnotatedResults/J20/DMPs/", full.names = T)
temp <- temp[-c(4,6)] # remove stats table files as we only need the significant results tables

overlap_list <- list()

#create gene lists

for(i in 1:length(temp)){
  
  # read in results file
  file <- read.csv(temp[i], stringsAsFactors = F)
  
  #Create list of RRBS chipseeker annotated genes
  ## reduce gene annotation to unique genes
  file[which(is.na(file$InGeneBodyOr1500bpTSS_SYMBOL)), "InGeneBodyOr1500bpTSS_SYMBOL"] <- "" # change NA's to ""
  RRBS_genes <- unlist(lapply(file$InGeneBodyOr1500bpTSS_SYMBOL, uniqueAnno))
  ## exclude sites with no gene anno
 if(sum(RRBS_genes == "") != 0){
    RRBS_genes <- RRBS_genes[-c(which(RRBS_genes == ""))]
  }

  # create list of genes and calc overlaps
  RRBS_genes <-unique(unlist(strsplit(RRBS_genes, "\\;")))
  chipseeker_overlap <- intersect(RRBS_genes, converted)

  overlap_list[[i]] <- sort(chipseeker_overlap)

  
  #populate table
  tab[i, "N.Results"] <- nrow(file)
  tab[i, "N.Genes"] <- length(RRBS_genes)
  tab[i,"N.COverlaps"] <- length(chipseeker_overlap)
  
}

kable(tab, caption = "RRBS J20")

```



```{r RRBS J20 vennDiagram, echo=FALSE, include=FALSE}
  
myCol <- c("azure2", "bisque1")

venn.diagram(
  x = list(converted, RRBS_genes),
  category.names = c("Meta-analysis", "RRBS"), imagetype = "png",
  filename = "images/RRBS_J20_pathology_meta.png", main = "RRBS J20 Pathology", fil = myCol, cat.default.pos= "text"
  )

```

<center>

![J20 Pathology](images/RRBS_J20_pathology_meta.png){width=50%}

</center>


List of RRBS J20 genes (annotated with chipseeker) which overlap 
with the meta-analysis gene list:

```{r RRBS J20 gene list, echo=FALSE}

geneList <- makeGeneList(overlap_list)
kable(geneList)

```


<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

### Array rTg4510

```{r Array rTg4510 DMPs, warning=F, message=F, echo = F, out.width="50%"}

#### ECX

#create summary table to hold information from for loop
ECX.tab <- data.frame(matrix(ncol = 4, nrow = 5))
colnames(ECX.tab) <- c("Model.Term", "N.ECX.Results", "N.ECX.Genes", "N.ECX.Overlaps")
ECX.tab$Model.Term <- c("Age", "Genotype", "Interaction", "Pathology", "Genotype.Only")


#load in files
temp <- list.files("/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/1500bpTSSAnnotations/", full.names = T)
temp <- temp[c(1,3,2,5,4)] # rearrange to same order as RRBS as just keep ECX files
#[1] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/With_3000bpTSS_Annotations//rTg4510_MME_ECX_Age_months_3000tssAnno.csv"            
#[2] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/With_3000bpTSS_Annotations//rTg4510_MME_ECX_Genotype_3000tssAnno.csv"              
#[3] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/With_3000bpTSS_Annotations//rTg4510_MME_ECX_AgeGenotypeInteraction_3000tssAnno.csv"
#[4] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/With_3000bpTSS_Annotations//rTg4510_MME_ECX_Pathology_3000tssAnno.csv"             
#[5] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/With_3000bpTSS_Annotations//rTg4510_MME_ECX_GenotypeOnlyModel_3000tssAnno.csv"  

ECX.overlap_list <- list()
ECX.array_genes_list <- list()

#create gene lists
for(i in 1:length(temp)){
  
  # read in results file
  file <- read.csv(temp[i], stringsAsFactors = F)
  
  #Create list of RRBS biomart annotated genes
  ## reduce gene annotation to unique genes
  file[which(is.na(file$InGeneBodyOr1500bpTSS_SYMBOL)), "InGeneBodyOr1500bpTSS_SYMBOL"] <- "" # change NA's to ""
  array_genes <-unlist(lapply(file$InGeneBodyOr1500bpTSS_SYMBOL, uniqueAnno))
  ## exclude sites with no gene anno
   if(sum(array_genes == "") != 0){
    array_genes <- array_genes[-c(which(array_genes == ""))]
  }
  # create list of genes
  array_genes <-unique(unlist(strsplit(array_genes, "\\;")))
  ECX.array_genes_list[[i]] <- array_genes
  
  #calculate number of overlaps between biomart, chipseeker and either gene list and meta-analysis gene list
  ECX.overlap <- intersect(array_genes, converted)
  ECX.overlap_list[[i]] <- sort(ECX.overlap)

  #populate table
  ECX.tab[i, "N.ECX.Results"] <- nrow(file)
  ECX.tab[i, "N.ECX.Genes"] <- length(array_genes)
  ECX.tab[i, "N.ECX.Overlaps"] <- length(ECX.overlap)
  
}


#### HIP

#create summary table to hold information from for loop
HIP.tab <- data.frame(matrix(ncol = 4, nrow = 5))
colnames(HIP.tab) <- c("Model.Term", "N.HIP.Results", "N.HIP.Genes", "N.HIP.Overlaps")
HIP.tab$Model.Term <- c("Age", "Genotype", "Interaction", "Pathology", "Genotype.Only")


#load in files
temp <- list.files("/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/1500bpTSSAnnotations/", full.names = T)
temp <- temp[c(6,8,7,10,9)] # rearrange to same order as RRBS as just keep HIP files
#[1] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/With_3000bpTSS_Annotations//rTg4510_MME_HIP_Age_months_3000tssAnno.csv"            
#[2] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/With_3000bpTSS_Annotations//rTg4510_MME_HIP_Genotype_3000tssAnno.csv"              
#[3] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/With_3000bpTSS_Annotations//rTg4510_MME_HIP_AgeGenotypeInteraction_3000tssAnno.csv"
#[4] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/With_3000bpTSS_Annotations//rTg4510_MME_HIP_Pathology_3000tssAnno.csv"             
#[5] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/With_3000bpTSS_Annotations//rTg4510_MME_HIP_GenotypeOnlyModel_3000tssAnno.csv"    

HIP.overlap_list <- list()
HIP.array_genes_list <- list()

#create gene lists
for(i in 1:length(temp)){
  
  # read in results file
  file <- read.csv(temp[i], stringsAsFactors = F)
  
  #Create list of RRBS biomart annotated genes
  ## reduce gene annotation to unique genes
  file[which(is.na(file$InGeneBodyOr1500bpTSS_SYMBOL)), "InGeneBodyOr1500bpTSS_SYMBOL"] <- "" # change NA's to ""
  array_genes <-unlist(lapply(file$InGeneBodyOr1500bpTSS_SYMBOL, uniqueAnno))
  ## exclude sites with no gene anno
   if(sum(array_genes == "") != 0){
    array_genes <- array_genes[-c(which(array_genes == ""))]
  }
  # create list of genes
  array_genes <-unique(unlist(strsplit(array_genes, "\\;")))
  HIP.array_genes_list[[i]] <- array_genes
  
  #calculate number of overlaps between biomart, chipseeker and either gene list and meta-analysis gene list
  HIP.overlap <- intersect(array_genes, converted)
  HIP.overlap_list[[i]] <- sort(HIP.overlap)

  

  #populate table
  HIP.tab[i, "N.HIP.Results"] <- nrow(file)
  HIP.tab[i, "N.HIP.Genes"] <- length(array_genes)
  HIP.tab[i, "N.HIP.Overlaps"] <- length(HIP.overlap)
  
  HIP.array_genes <- array_genes
  
}

tab <- left_join(ECX.tab, HIP.tab)


kable(tab, caption = "Array rTg4510")

```


```{r Array rTg4510 code vennDiagram, echo=FALSE, include=FALSE}

myCol <- c("azure2", "bisque1")

venn.diagram(
  x = list(converted, ECX.array_genes_list[[4]]),
  category.names = c("Meta-analysis", "Array (ECX)"), imagetype = "png",
  filename = "images/Array_rTg4510_ECX_pathology_meta.png", main = "Array rTg4510 ECX Pathology", fil = myCol, cat.default.pos= "text"
  )

venn.diagram(
  x = list(converted, HIP.array_genes_list[[4]]),
  category.names = c("Meta-analysis", "Array (HIP)"), imagetype = "png",
  filename = "images/Array_rTg4510_HIP_pathology_meta.png", main = "Array rTg4510 HIP Pathology", fil = myCol, cat.default.pos= "text"
  )

```


```{r, echo=FALSE,out.width="49%", out.height="20%", fig.cap="rTg4510", fig.show='hold',fig.align='center'}

knitr::include_graphics(c("images/Array_rTg4510_ECX_pathology_meta.png", "images/Array_rTg4510_HIP_pathology_meta.png"))

``` 


<p>&nbsp;</p>



List of array rTg4510 genes which overlap with the meta-analysis gene list:

```{r Array rTg4510  gene list, echo=FALSE}

ECX.geneList <- makeGeneList(ECX.overlap_list)
ECXcols <- paste0("ECX.",colnames(ECX.geneList))
colnames(ECX.geneList) <- ECXcols

HIP.geneList <- makeGeneList(HIP.overlap_list)
HIPcols <- paste0("HIP.",colnames(HIP.geneList))
colnames(HIP.geneList) <- HIPcols

geneList <- cbind.fill(ECX.geneList, HIP.geneList)
geneList[is.na(geneList)] <- ""


kable(geneList)

```


### Array J20

```{r Array J20 DMPs, warning=F, message=F, echo = F, out.width="50%"}

#### ECX

#create summary table to hold information from for loop
ECX.tab <- data.frame(matrix(ncol = 4, nrow = 4))
colnames(ECX.tab) <- c("Model.Term", "N.ECX.Results", "N.ECX.Genes", "N.ECX.Overlaps")
ECX.tab$Model.Term <- c("Age", "Genotype", "Pathology", "Genotype.Only")


#load in files
temp <- list.files("/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/J20/SigResults/1500bpTSSAnnotations/", full.names = T)
temp <- temp[c(1,2,4,3)] # just keep ECX files and rearrange to right order 
#[1] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/J20/SigResults/With_3000bpTSS_Annotations//J20_MME_ECX_Age_months_3000tssAnno.csv"       
#[2] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/J20/SigResults/With_3000bpTSS_Annotations//J20_MME_ECX_Genotype_3000tssAnno.csv"         
#[3] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/J20/SigResults/With_3000bpTSS_Annotations//J20_MME_ECX_Pathology_3000tssAnno.csv"        
#[4] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/J20/SigResults/With_3000bpTSS_Annotations//J20_MME_ECX_GenotypeOnlyModel_3000tssAnno.csv"

ECX.overlap_list <- list()
ECX.array_genes_list <- list()


#create gene lists
for(i in 1:length(temp)){

  # read in results file
  file <- read.csv(temp[i], stringsAsFactors = F)
  
  #Create list of genes
  ## reduce gene annotation to unique genes
  file[which(is.na(file$InGeneBodyOr1500bpTSS_SYMBOL)), "InGeneBodyOr1500bpTSS_SYMBOL"] <- "" # change NA's to ""
  array_genes <-unlist(lapply(file$InGeneBodyOr1500bpTSS_SYMBOL, uniqueAnno))
  ## exclude sites with no gene anno
   if(sum(array_genes == "") != 0){
    array_genes <- array_genes[-c(which(array_genes == ""))]
  }
  # create list of genes
  array_genes <-unique(unlist(strsplit(array_genes, "\\;")))
  ECX.array_genes_list[[i]] <- array_genes
  
  #calculate number of overlaps between biomart, chipseeker and either gene list and meta-analysis gene list
  ECX.overlap <- intersect(array_genes, converted)
  ECX.overlap_list[[i]] <- sort(ECX.overlap)


  #populate table
  ECX.tab[i, "N.ECX.Results"] <- nrow(file)
  ECX.tab[i, "N.ECX.Genes"] <- length(array_genes)
  ECX.tab[i, "N.ECX.Overlaps"] <- length(ECX.overlap)
  
}
  
  #add row to table for interaction term as there was no results
  Interaction <- c("Interaction", 0, NA, NA)
  ECX.tab <- InsertRow(ECX.tab, Interaction, 3)
  

#### HIP

#create summary table to hold information from for loop
HIP.tab <- data.frame(matrix(ncol = 4, nrow = 5))
colnames(HIP.tab) <- c("Model.Term", "N.HIP.Results", "N.HIP.Genes", "N.HIP.Overlaps")
HIP.tab$Model.Term <- c("Age", "Genotype", "Interaction", "Pathology", "Genotype.Only")


#load in files
temp <- list.files("/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/J20/SigResults/1500bpTSSAnnotations/", full.names = T)
temp <- temp[c(5,7,6,9,8)] # rearrange to same order as RRBS as just keep HIP files
#[1] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/J20/SigResults/With_3000bpTSS_Annotations//J20_MME_HIP_Age_months_3000tssAnno.csv"            
#[2] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/J20/SigResults/With_3000bpTSS_Annotations//J20_MME_HIP_Genotype_3000tssAnno.csv"              
#[3] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/J20/SigResults/With_3000bpTSS_Annotations//J20_MME_HIP_AgeGenotypeInteraction_3000tssAnno.csv"
#[4] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/J20/SigResults/With_3000bpTSS_Annotations//J20_MME_HIP_Pathology_3000tssAnno.csv"             
#[5] "/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/J20/SigResults/With_3000bpTSS_Annotations//J20_MME_HIP_GenotypeOnlyModel_3000tssAnno.csv"    

HIP.overlap_list <- list()
HIP.array_genes_list <- list()


#create gene lists
for(i in 1:length(temp)){
  
  # read in results file
  file <- read.csv(temp[i], stringsAsFactors = F)
  
  #Create list of RRBS biomart annotated genes
  ## reduce gene annotation to unique genes
  file[which(is.na(file$InGeneBodyOr1500bpTSS_SYMBOL)), "InGeneBodyOr1500bpTSS_SYMBOL"] <- "" # change NA's to ""
  array_genes <-unlist(lapply(file$InGeneBodyOr1500bpTSS_SYMBOL, uniqueAnno))
  ## exclude sites with no gene anno
   if(sum(array_genes == "") != 0){
    array_genes <- array_genes[-c(which(array_genes == ""))]
  }
  # create list of genes
  array_genes <-unique(unlist(strsplit(array_genes, "\\;")))
  HIP.array_genes_list[[i]] <- array_genes

  
  #calculate number of overlaps between biomart, chipseeker and either gene list and meta-analysis gene list
  HIP.overlap <- intersect(array_genes, converted)
  HIP.overlap_list[[i]] <- sort(HIP.overlap)

  #populate table
  HIP.tab[i, "N.HIP.Results"] <- nrow(file)
  HIP.tab[i, "N.HIP.Genes"] <- length(array_genes)
  HIP.tab[i, "N.HIP.Overlaps"] <- length(HIP.overlap)
  
}

tab <- left_join(ECX.tab, HIP.tab)


kable(tab, caption = "Array J20", align = c('l','r','r','r','r','r','r'))

```

```{r Array J20 code vennDiagram, echo=FALSE, include=FALSE}

myCol <- c("azure2", "bisque1")

venn.diagram(
  x = list(converted, ECX.array_genes_list[[3]]),
  category.names = c("Meta-analysis", "Array (ECX)"), imagetype = "png",
  filename = "images/Array_J20_ECX_pathology_meta.png", main = "Array J20 ECX Pathology", fil = myCol, cat.default.pos= "text"
  )

venn.diagram(
  x = list(converted, HIP.array_genes_list[[4]]),
  category.names = c("Meta-analysis", "Array (HIP)"), imagetype = "png",
  filename = "images/Array_J20_HIP_pathology_meta.png", main = "Array J20 HIP Pathology", fil = myCol, cat.default.pos= "text"
  )

```

```{r, echo=FALSE,out.width="49%", out.height="20%", fig.cap="J20",fig.show='hold',fig.align='center'}

knitr::include_graphics(c("images/Array_J20_ECX_pathology_meta.png", "images/Array_J20_HIP_pathology_meta.png"))

``` 

<p>&nbsp;</p>

List of array J20 genes which overlap with the meta-analysis gene list:


```{r Array J20  gene list, echo=FALSE}

# add extra row for ECX interaction
ECX.overlap_list <- append(ECX.overlap_list, list(character(0)), after = 2)

ECX.geneList <- makeGeneList(ECX.overlap_list)
ECXcols <- paste0("ECX.",colnames(ECX.geneList))
colnames(ECX.geneList) <- ECXcols

HIP.geneList <- makeGeneList(HIP.overlap_list)
HIPcols <- paste0("HIP.",colnames(HIP.geneList))
colnames(HIP.geneList) <- HIPcols

geneList <- cbind.fill(ECX.geneList, HIP.geneList)
geneList[is.na(geneList)] <- ""


kable(geneList)

```



### Union of RRBS and Array rTg4510 genes

```{r join RRBS and array gene lists, warning=F, message=F, echo = F}

# Create object containing genes from either tech

tab <- data.frame(matrix(ncol = 5, nrow = 4))
colnames(tab) <- c("Model.Term", "N.RRBS.Genes", "N.Array.Genes", "N.Total.Genes", "N.Overlaps")
tab$Model.Term <- c("Age", "Genotype", "Interaction", "Pathology")

unionGeneList <- list()

# read in RRBS files
RRBSfiles <- list.files("/gpfs/ts0/projects/Research_Project-191406/EmmaW/RRBSAnnotatedResults/rTg4510/DMPs/", full.names = T)
RRBSfiles <- RRBSfiles[-c(4,6)] # remove stats table files as we only need the significant results tables
#read in array ECX files
arrayFiles <- list.files("/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/rTg4510/SigResults/1500bpTSSAnnotations/", full.names = T)
arrayFiles <- arrayFiles[c(1,3,2,5)] # rearrange to same order as RRBS and just keep ECX files (exclude gneo only model as not done in RRBS)

# create union set of genes
for(i in 1:length(arrayFiles)){
  
  RRBS <- read.csv(RRBSfiles[i], stringsAsFactors = F)
  RRBSgenes <- RRBS$InGeneBodyOr1500bpTSS_SYMBOL
  RRBSgenes[which(is.na(RRBSgenes))] <- "" # change NA's to ""
  ## exclude sites with no gene anno
   if(sum(RRBSgenes == "") != 0){
    RRBSgenes <- RRBSgenes[-c(which(RRBSgenes == ""))]
  }
  RRBSgenes <- unique(RRBSgenes)
  
  
  array <- read.csv(arrayFiles[i], stringsAsFactors = F)
  arraygenes <- array$InGeneBodyOr1500bpTSS_SYMBOL
  arraygenes[which(is.na(arraygenes))] <- "" # change NA's to ""
  ## exclude sites with no gene anno
   if(sum(arraygenes == "") != 0){
    arraygenes <- arraygenes[-c(which(arraygenes == ""))]
  }
  arraygenes <- unique(arraygenes)

  unionGenes <- union(RRBSgenes, arraygenes)
  union_overlaps <- intersect(converted, unionGenes)
  unionGeneList[[i]] <- sort(union_overlaps)
  
  
  colnames(tab) <- c("Model.Term", "N.RRBS.Genes", "N.Array.Genes", "N.Total.Genes", "N.Overlaps")

  #populate table
  tab[i, "N.RRBS.Genes"] <- length(RRBSgenes)
  tab[i, "N.Array.Genes"] <- length(arraygenes)
  tab[i, "N.Total.Genes"] <- length(unionGenes)
  tab[i, "N.Overlaps"] <- length(union_overlaps)
}


#names(unionGeneList) <- c("Age", "Genotype", "Interaction", "Pathology")


kable(tab)
```


```{r union rTg4510 code vennDiagram, echo=FALSE, include=FALSE}
  
myCol <- c("azure2", "bisque1")

venn.diagram(
  x = list(converted, unionGenes),
  category.names = c("Meta-analysis", "Union of RRBS/Array genes"), imagetype = "png",
  filename = "images/Union_rTg4510_pathology_meta.png", main = "Union rTg4510 Pathology", fil = myCol, cat.default.pos= "text"
  )

```
<center>

![Union Pathology](images/Union_rTg4510_pathology_meta.png){width=50%}

List of RRBS rTg4510 genes (annotated with chipseeker) which overlap 
with the meta-analysis gene list:

```{r union rTg4510 gene list, echo=FALSE}

geneList <- makeGeneList(unionGeneList)
kable(geneList)

```


### Union of RRBS and Array J20 genes

NB: There were no significant results for the interaction term for the array data.

```{r J20 join RRBS and array gene lists, warning=F, message=F, echo = F}

# Create object containing genes from either tech

tab <- data.frame(matrix(ncol = 5, nrow = 3))
colnames(tab) <- c("Model.Term", "N.RRBS.Genes", "N.Array.Genes", "N.Total.Genes", "N.Overlaps")
tab$Model.Term <- c("Age", "Genotype", "Pathology")

unionGeneList <- list()

# read in RRBS files
RRBSfiles <- list.files("/gpfs/ts0/projects/Research_Project-191406/EmmaW/RRBSAnnotatedResults/J20/DMPs/", full.names = T)
RRBSfiles <- RRBSfiles[-c(3,4,6)] # remove stats table files as we only need the significant results tables, and results for interaction as there is no array results to pair it with
#read in array ECX files
arrayFiles <- list.files("/gpfs/ts0/projects/Research_Project-191406/EmmaW/Array/Results/J20/SigResults/1500bpTSSAnnotations/", full.names = T)

arrayFiles <- arrayFiles[c(1,2,4)] # rearrange to same order as RRBS and just keep ECX files (exclude geno only model as not done in RRBS)

# create union set of genes
for(i in 1:length(arrayFiles)){
  
  RRBS <- read.csv(RRBSfiles[i], stringsAsFactors = F)
  RRBSgenes <- RRBS$InGeneBodyOr1500bpTSS_SYMBOL
  RRBSgenes[which(is.na(RRBSgenes))] <- "" # change NA's to ""
  ## exclude sites with no gene anno
   if(sum(RRBSgenes == "") != 0){
    RRBSgenes <- RRBSgenes[-c(which(RRBSgenes == ""))]
  }
  RRBSgenes <- unique(RRBSgenes)
  
  
  array <- read.csv(arrayFiles[i], stringsAsFactors = F)
  arraygenes <- array$InGeneBodyOr1500bpTSS_SYMBOL
  arraygenes[which(is.na(arraygenes))] <- "" # change NA's to ""
  ## exclude sites with no gene anno
   if(sum(arraygenes == "") != 0){
    arraygenes <- arraygenes[-c(which(arraygenes == ""))]
  }
  arraygenes <- unique(arraygenes)

  unionGenes <- union(RRBSgenes, arraygenes)
  union_overlaps <- intersect(converted, unionGenes)
  unionGeneList[[i]] <- sort(union_overlaps)

  
  
  colnames(tab) <- c("Model.Term", "N.RRBS.Genes", "N.Array.Genes", "N.Total.Genes", "N.Overlaps")

  #populate table
  tab[i, "N.RRBS.Genes"] <- length(RRBSgenes)
  tab[i, "N.Array.Genes"] <- length(arraygenes)
  tab[i, "N.Total.Genes"] <- length(unionGenes)
  tab[i, "N.Overlaps"] <- length(union_overlaps)
}

kable(tab)
```

```{r union J20 code vennDiagram, echo=FALSE, include=FALSE}
  
myCol <- c("azure2", "bisque1")

venn.diagram(
  x = list(converted, unionGenes),
  category.names = c("Meta-analysis", "Union of RRBS/Array genes"), imagetype = "png",
  filename = "images/Union_J20_pathology_meta.png", main = "Union J20 Pathology", fil = myCol, cat.default.pos= "text"
  )


```
<center>

![J20 Union Pathology](images/Union_J20_pathology_meta.png){width=50%}

```{r union J20 gene list, echo=FALSE}

geneList <- makeGeneList(unionGeneList)
kable(geneList)

```

